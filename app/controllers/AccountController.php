<?php/** * Created by PhpStorm. * User: chenli * Date: 6/17/15 * Time: 12:04 PM */namespace app\controllers;use yii;use common\base\BaseController;use common\models\framework\FwUser;use frontend\viewmodels\ChangePasswordForm;use yii\base\InvalidParamException;use yii\web\BadRequestHttpException;use yii\web\Response;use common\services\learning\CourseService;use common\services\social\ShareService;use common\services\social\QuestionService;use common\services\learning\RecordService;class AccountController extends BaseController{    public  $layout = 'main';    /**     *用户信息详情     */    public function actionHome()    {        $id = Yii::$app->user->getId();        $model = FwUser::findOne($id);        $companyName = $model->getCompanyName();        $domainName = $model -> getDomainName();        $orgnizationName = $model -> getOrgnizationName();        $this->getView()->title = "个人信息";        return $this->render(            'accountInfo', array(                'userModel' => $model,                'companyName' => $companyName,                'domainName'=>$domainName,                'orgnizationName'=>$orgnizationName,            ));    }    public function actionUserinfo()    {        $id = Yii::$app->user->getId();        $model = FwUser::findOne($id);        $json = json_encode(array('userName'=>$model->user_name,'displayName'=>$model->user_display_name));        header("Content-type:json/application;charset=utf-8");//        echo json_encode($json);        return Yii::$app->response-json_encode($model);    }    public function actionPassword()    {        $id = Yii::$app->user->getId();        $changeModel = new ChangePasswordForm($id);        $this->getView()->title = "密码修改";        return $this->render('changePassword',['changeModel' => $changeModel]);    }    public function actionChangePassword()    {        Yii::$app->response->format = Response::FORMAT_JSON;        $id = Yii::$app->user->getId();        try {            $model = new ChangePasswordForm($id);        } catch (InvalidParamException $e) {            throw new BadRequestHttpException($e->getMessage());        }        if ($model->load(Yii::$app->request->post())) {            if ($model->validate()) {                return $model->changePassword();            } else {                $errors = array_values($model->getErrors());                $message = '';                for ($i = 0; $i < count($errors); $i++) {                    $message .= $errors[$i][0] . '<br />';                }                return ['result' => 'other', 'message' => $message];            }        }        return ['result' => 'failure'];    }    ///我的学习历程    public function actionMyPath()    {        $this->layout = 'search';        $this->getView()->title = "我的学习历程";        return $this->render('my-path');    }    public function  actionMyCoursePath($page, $time = null)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $size = 10;        $service = new CourseService();        $data = $service->getAllRegCourseByUid($id, $time, $size, $page);        return $this->render('tab-path-course', [            'data' => $data        ]);    }    /**     * 学习历程->问答     */    public function actionGetQuestion($page, $time = null)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $size = 10;        $service = new QuestionService();        $question = $service->getQuestionPageDataById($id, $time, $size, $page);        return $this->render('tab-info-question', [            'data' => $question,        ]);    }    /**     * 学习历程->分享     */    public function actionGetShare($page)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $service = new ShareService();        $size = 10;        $share = $service->getSharePageDataById($id, $size, $page);        return $this->render('tab-student-share', [            'data' => $share,        ]);    }    /**     * 学习历程->记录     */    public function actionGetRecord($page)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $service = new RecordService();        $size = 10;        $record = $service->getRecordPageDataById($id, $size, $page);        return $this->render('tab-student-record', [            'data' => $record,        ]);    }    //收藏关注    public function actionCollect()    {        $this->layout = 'search';        $this->getView()->title = "收藏关注";       return $this->render('collect');    }    public function actionGetAllAttention($page, $filter = null, $time = null)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $filter = $filter ? $filter : 3;        $size = 10;        $service = new UserService();        $data = $service->getAttentionByUid($id, $filter, $time, $size, $page);        return $this->render('tab-info-attention', [            'data' => $data,        ]);    }    public function actionGetCollect($page, $time = null)    {        $this->layout = 'none';        $id = Yii::$app->user->getId();        $size = 10;        $service = new CollectService();        $collect = $service->getPageDataByUserId($id, $time, $size, $page);        return $this->render('tab-info-collect', [            'data' => $collect,        ]);    }    public  function actionIndex()    {        echo 'index';    }}