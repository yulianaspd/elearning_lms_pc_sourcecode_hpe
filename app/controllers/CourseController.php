<?php/** * Created by PhpStorm. * User: chenli * Date: 6/24/15 * Time: 12:09 AM */namespace app\controllers;use yii;use app\base\BaseAppController;use common\base\BaseController;use common\services\learning\CourseService;use common\services\learning\ResourceService;use yii\web\NotFoundHttpException;use yii\web\Response;class CourseController extends BaseController {    /**     * Displays a single LnCourse model.     * @param string $id     * @return mixed     */    public  $layout = 'main';    public function actionView($id)    {        $this->layout ='main';        //课程模块及组件        $user_id = Yii::$app->user->getId();        //课程模块及组件        $service = new ResourceService();        $courseMods = $service->getCourseMods($id);        /*判断是否注册*/        $courseService = new CourseService();        $isReg = $courseService->isUserRegCourse($user_id, $id, $courseRegId);//        $canRating = true;        if (!$isReg) {            $canRating = false;        } else {            $canRating = !$courseService->isRating($user_id, $id);        }        $rating = number_format($courseService->getCourseMarkByID($id), 1);        return $this->render('view', [            'model' => $this->findModel($id),            'courseMods' => $courseMods,            'isReg' => $isReg,            'rating' => $rating,            'canRating' => $canRating,        ]);    }    public function actionPlay($id,$modid = null,$resid = null){        //课程模块及组件        $service = new ResourceService();        $courseMods = $service->getCourseMods($id);        return $this->render('play', [            'modid'=>$modid,            'resid'=>$resid,            'model' => $this->findModel($id),            'courseMods' => $courseMods,        ]);    }    public function actionDetailView(){            }    protected function findModel($id)    {        if (($model = CourseService::findOne($id)) !== null) {            return $model;        } else {            throw new NotFoundHttpException(Yii::t('common','data_not_exist'));        }    }} 