<?php/** * Created by PhpStorm. * User: kaylio * Date: 15/5/20 * Time: 16:56 */use common\models\learning\LnCourse;use common\models\learning\LnCourseEnroll;use common\models\learning\LnCourseSignIn;use common\helpers\TStringHelper;use common\services\learning\CourseService;use common\services\learning\ResourceCompleteService;use yii\helpers\Html;use yii\helpers\Url;use components\widgets\TModal;use components\widgets\TBreadcrumbs;use yii\widgets\ActiveForm;$this->params['breadcrumbs'][] = ['url' => Yii::$app->urlManager->createUrl('resource/course/index'), 'label' => Yii::t('frontend', 'page_learn_path_tab_1')];$this->params['breadcrumbs'][] = Yii::t('frontend', 'course_detail');$this->params['breadcrumbs'][] = $model->course_name;$btnHtml = '';if ($btn){    $btnCode = $btn['code'];    $btnTxt = $btn['label'];    if ($btnCode == 'NOT_PUTAWAY' || $btnCode == 'TAKEN_OFF'){        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn">'.$btnTxt.'</a>';    }else{        if ($isOnlineCourse){            if (!$isReg){                $btnHtml = '<a href="javascript:RegisterCourse(\'' . $model->kid . '\');" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';            }else{                if ($isCourseComplete) {                    if ($btnCode == 'RETAKE'){                        $btnHtml = '<a href="javascript:RestartConfirm(\'' . $model->kid . '\');" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }else{                        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }                }else{                    if ($btnCode == 'APPROVING'){                        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }elseif ($btnCode == 'APPROVE_NOT_PASSED'){                        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }elseif ($btnCode == 'CANCELED'){                        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }else{                        if (!isset($btn['code']) && !isset($btn['label']) && is_array($btn)){                            foreach ($btn as $item){                                if ($item['code'] == 'QUIT_AND_LEARN') {                                    $btnHtml .= '<a href="javascript:GiveupRestartConfirm(\'' . $model->kid . '\');" class="btn btn-success btn-sm pull-right" id="regBtn" style="right: 90px;">' . $item['label'] . '</a>';                                }                                if ($item['code'] == 'GETTING_STARTED'){                                    $btnHtml .= '<a href="' . Yii::$app->urlManager->createUrl(['resource/course/play', 'modResId' => $modResId]) . '" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$item['label'].'</a>';                                }                                if ($item['code'] == 'CONTINUE_LEARN'){                                    $btnHtml .= '<a href="' . Yii::$app->urlManager->createUrl(['resource/course/play', 'modResId' => $modResId]) . '" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$item['label'].'</a>';                                }                            }                        }elseif ($btnCode == 'GETTING_STARTED'){                            $btnHtml = '<a href="' . Yii::$app->urlManager->createUrl(['resource/course/play', 'modResId' => $modResId]) . '" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.Yii::t('frontend', 'start_learning').'</a>';                        }else{                            //显示不能点的开始学习                            if (empty($btnHtml))                                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.Yii::t('frontend', 'start_learning').'</a>';                        }                    }                }            }        }else{            if (empty($enrollInfo)) {                if ($btnCode == 'NOT_STARTED') {/*未开始*/                    $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' . $btnTxt . '</a>';                } elseif ($btnCode == 'REGISTER') {/*未报名*/                    $btnHtml = '<a href="javascript:EnrollCourse();" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' .$btnTxt. '</a>';                } elseif ($btnCode == 'REGISTRATION_ENDS') {/*报名结束*/                    $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' .$btnTxt. '</a>';                } elseif ($btnCode == 'END_UP') {/*课程结束*/                    $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';                } else {                    $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' .$btnTxt . '</a>';                }            }elseif ($btnCode == 'FAILED_TO_ENROLL'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'APPROVING'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'APPROVE_NOT_PASSED') {                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'CANCELED'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'ENROLL_APPROVING'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'ENROLL_SUCCEED'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';            }elseif ($btnCode == 'END_UP'){                $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';            }else{                if (!$isReg) {                    if ($btnCode == 'REGISTER') {                        $btnHtml = '<a href="javascript:EnrollCourse();" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' .$btnTxt . '</a>';                    }                }else{                    if ($btnCode == 'COMPLETED'){                        $btnHtml = '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';                    }else{                        if (!empty($modResId)) {                            $btnHtml = '<a href="' . Yii::$app->urlManager->createUrl(['resource/course/play', 'modResId' => $modResId]) . '" class="btn btn-success btn-sm pull-right" id="regBtn" style="margin: 0 5px;">' .$btnTxt. '</a>';                        }else{                            $btnHtml .= '<a href="#" class="btn btn-default btn-sm pull-right" id="regBtn" style="margin: 0 5px;">'.$btnTxt.'</a>';                        }                    }                }            }        }    }}?><style>    *{word-break: break-all;}    /*.course_desc span {color: inherit!important; margin: auto!important;}*/    #newTask .myGroupList_mini .thumbList li {float: left; width: 50%;}    .courseInfo{        float: left;    }    .barCode{        cursor: text !important;    }    .-query-add-list{        right: 15px    }    .tdwrapper #search_people{width:160px}</style><div class="container">    <div class="row">        <?= TBreadcrumbs::widget([            'tag' => 'ol',            'links' => isset($this->params['breadcrumbs']) ? $this->params['breadcrumbs'] : [],        ]) ?>        <div class="col-md-12">            <div class="panel panel-default hotNews">                <div class="panel-heading">                    <i class="glyphicon glyphicon-dashboard"></i> <?=Yii::t('frontend', 'signin_all_date')?><?=Yii::t('frontend', 'introduction_course')?>                    <a href="javascript:;" class="btnTitle pull-right" style="margin-right: 5px;" onclick="ToggleCollection('<?=$model->kid?>',this)" id="newFollowBtn"><?=$model->getCourseCollectionText()?></a>                    <?if ($isManager && $isOnlineCourse): ?>                        <a href="javascript:;" class="btnTitle pull-right" id="newTaskBtn" style="margin-right: 5px;"><?=Yii::t('common', 'assign')?></a>                    <? endif?>                    <a href="javascript:;" class="btnTitle pull-right" id="newShareBtn" style="margin-right: 5px;"><?=Yii::t('frontend', 'share')?></a>                </div>                <div class="panel-body">                    <div class="courseTitle">                        <div class="left" style="margin-top:60px;">                            <img width="452px" src="<?= $model->theme_url ? $model->getCourseCover() : '/static/frontend/images/course_theme_big.png'?>"/>                        </div>                        <div class="right">                            <h2 class="lessWord" style="width: 100%;margin: 15px 0 10px 0;" title="<?=Html::encode($model->course_name)?>"><?=Html::encode($model->course_name)?></h2>                            <span style="display: inline-block;width: 100%;padding: 8px 5px;background: #f6f6f6;">                                <?php                                if (!empty($enrollInfo) && $enrollInfo->enroll_type == LnCourseEnroll::ENROLL_TYPE_ALLOW) {                                    if ($model->open_status == LnCourse::COURSE_NOT_START) {                                        echo '<a href="#" class="btn courseStatu">'.Yii::t('frontend', 'waiting_for_class').'</a>';                                    } else if ($model->open_status == LnCourse::COURSE_START) {                                        echo '<a href="#" class="btn courseStatu">'.Yii::t('frontend', 'complete_status_doing').'</a>';                                    } else if ($model->open_status == LnCourse::COURSE_END) {                                        echo '<a href="#" class="btn courseStatu">'.Yii::t('frontend', 'complete_status_done').'</a>';                                    }                                }                                ?>                                <?php                                if (!$isOnlineCourse && $openStatus == LnCourse::STATUS_FLAG_NORMAL && !empty($enrollInfo) && $enrollInfo->enroll_type == LnCourseEnroll::ENROLL_TYPE_ALLOW):                                ?>                                <a class="btn btn-sm pull-right" id="allSignIn" style="margin: 0 5px;"><?=Yii::t('common', '{value}_record',['value'=>''])?></a>                                <?php                                    if ($model->open_status != LnCourse::COURSE_END) {                                        if ($signStatusData['result']==1) {                                            if($signStatusData['sign_status']==LnCourseSignIn::SIGN_STATUS_NO_SIGN_IN){                                            ?>                                            <a class="btn btn-success btn-sm pull-right signInBtn" style="margin: 0 5px;"><?=Yii::t('frontend', 'signin_btn')?></a>                                            <?php                                            } else {                                            ?>                                            <a class="btn btn-default btn-sm pull-right" style="margin: 0 5px;"><?=$signStatusData['sign_title'].$signStatusData['sign_status_text']?></a>                                            <?php                                            }                                        }else{                                        ?>                                            <a class="btn btn-default btn-sm pull-right" style="margin: 0 5px;"><?=Yii::t('frontend', 'signin_not')?></a>                                <?php                                        }                                    }                                endif;                                ?>                                <?=$btnHtml?>                            </span>                            <table>                                <tr>                                    <td width="50%"><span><strong><?=Yii::t('common','course_code')?>:</strong> <?=$model->course_code?></span></td>                                    <td>                                        <span><strong><?=Yii::t('common','category_id')?>:</strong> <?=$model->getCourseCategoryText()?></span>                                    </td>                                </tr>                                <tr>                                    <td><span><strong><?=Yii::t('common','course_type')?>:</strong> <?=$model->course_type==LnCourse::COURSE_TYPE_ONLINE?Yii::t('frontend', 'course_online'):Yii::t('frontend', 'course_face')?></span></td>                                    <td>                                        <span><strong><?=Yii::t('common','course_default_credit')?>:</strong> <?=$model->default_credit?></span>                                    </td>                                </tr>                                <?php                                if ($isOnlineCourse) {                                    ?>                                <tr>                                    <td><span><strong><?= Yii::t('common', 'course_level') ?> :</strong> <?= $model->getDictionaryText('course_level', $model->course_level) ?></span></td>                                    <td><span><strong><?=Yii::t('common','course_period')?>:</strong> <?=$model->course_period?><?=$model->getCoursePeriodUnits($model->course_period_unit)?></span></td>                                </tr>                                <?php                                }                                ?>                                <tr>                                    <td><span><strong><?=Yii::t('common','course_language')?>:</strong> <?=$model->getDictionaryText('course_language',$model->course_language)?></span></td>                                    <td><span><strong><?=Yii::t('common','course_price')?>:</strong> <?=$model->getPriceUnit($model->currency)?> <?=$model->course_price?></span></td>                                </tr>                                <?php                                if ($isOnlineCourse) {                                ?>                                <tr>                                    <td colspan="2"><span><strong><?= Yii::t('common', 'time_validity') ?>:</strong>                                            <?php                                            $end_time = $model->end_time ? date("Y-m-d", $model->end_time) : Yii::t('frontend', 'forever');                                            ?>                                            <?=date("Y-m-d", $model->start_time)?> <?=Yii::t('common', 'to2')?> <?= $end_time ?></span>                                    </td>                                </tr>                                <?php                                }                                ?>                                <tr>                                    <td>                                        <strong><?=Yii::t('frontend', 'give_a_mark')?>:&nbsp;</strong><div id="rating" class="ui star rating" data-name="pingfen" data-rating="<?=floor($rating)?>" data-rating-full="<?=$rating?>" data-max-rating="5" data-person="<?=$rating_count ?>" title="<?=$rating?><?=Yii::t('frontend', 'point')?>"></div></i>                                    </td>                                    <td>                                        <strong style="float:left; margin-right:10px;"><?=Yii::t('frontend', 'qr_code')?>:&nbsp;</strong>                                        <div class="barCode pull-left">                                            <span><img src="<?=TStringHelper::genQRCode($model->short_code)?>" height="128" width="128"></span>                                        </div>                                        <a href="#" onclick="bigcode()"><?=Yii::t('frontend', 'enlarge')?></a>                                    </td>                                </tr>                                <?php                                if (!$isOnlineCourse){                                    $start_time = ceil(($model->open_end_time-$model->open_start_time)/86400);                                    if ($start_time < 0) $start_time = 0;                                    $remaining = $model->limit_number - $enrollRegNumber;/*剩余*/                                    $remaining = ($remaining > 0) ? $remaining : 0;                                ?>                                <tr>                                    <td>                                    <span>                                        <strong><?=Yii::t('common', 'time')?>:&nbsp;</strong>                                        <?=$start_time?> <?=Yii::t('common', 'time_day')?>                                    </span>                                    </td>                                    <td>                                    <span>                                        <strong><?=Yii::t('frontend', 'places')?>:&nbsp;</strong>                                        <?=$model->limit_number?>(<?=Yii::t('frontend', 'surplus')?><?=$remaining?><?=Yii::t('frontend', 'people')?>)                                    </span>                                    </td>                                </tr>                                <tr>                                    <td>                                        <span>                                            <strong><?=Yii::t('frontend', 'enroll_time')?>:&nbsp;</strong>                                            <?=date('Y年m月d日', $model->enroll_start_time)?> ～ <?=date('m月d日', $model->enroll_end_time)?>                                            <? if (!empty($model->enroll_start_time)) { ?>                                                <a href="<?=Yii::$app->urlManager->createUrl(["/resource/course/download-calendar","courseId"=>$model->kid, "type"=>"enroll"])?>" title="<?=Yii::t('frontend', 'save_calendar')?>" target="_blank" style="display:none;"><img src="/static/frontend/images/calendar.gif" width="32px" height="32px"></a>                                            <? } ?>                                        </span>                                    </td>                                    <td><span><strong><?=Yii::t('common','course_period')?>:</strong> <?=$model->course_period?><?=$model->getCoursePeriodUnits($model->course_period_unit)?></span></td>                                </tr>                                <tr>                                    <td colspan="2">                                        <span>                                            <strong><?=Yii::t('frontend', 'start_course_time')?>:&nbsp;</strong>                                            <?=date('Y年m月d日', $model->open_start_time)?> ～ <?=date('m月d日', $model->open_end_time)?>                                            <? if (!empty($model->open_start_time)) { ?>                                                <a href="<?=Yii::$app->urlManager->createUrl(["/resource/course/download-calendar","courseId"=>$model->kid, "type"=>"open"])?>" title="<?=Yii::t('frontend', 'save_calendar')?>" target="_blank" style="display: none;"><img src="/static/frontend/images/calendar.gif" width="32px" height="32px"></a>                                            <? } ?>                                        </span>                                    </td>                                </tr>                                <tr>                                    <td colspan="2">                                        <span>                                            <strong><?=Yii::t('frontend', 'place')?>:&nbsp;</strong>                                            <?=$model->training_address?>                                        </span>                                    </td>                                </tr>                                <?php                                }                                ?>                            </table>                        </div>                    </div>                    <div class="courseInfo">                        <ul class="nav nav-tabs hotNews" role="tablist" id="myTab">                            <li role="presentation" class="active"><a href="#courseIntro" aria-controls="courseIntro" role="tab" data-toggle="tab"><?=Yii::t('frontend', 'course_content')?></a></li>                            <?php                            if (!empty($certificationTemplatesUrl)) {                                ?>                                <li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab"><?=Yii::t('common', 'serial')?></a></li>                            <?php                            }                            if (!empty($teacher)) {                                ?>                                <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab"><?=Yii::t('common', 'lecturer')?></a></li>                            <?php                            }                            ?>                            <li role="presentation"><a href="#question" aria-controls="question" role="tab" data-toggle="tab" class="getQuestion"><?=Yii::t('frontend', 'question_answer')?></a></li>                            <?php                            if ($isOnlineCourse){                            ?>                            <li role="presentation"><a href="#courseRule" aria-controls="courseRule" role="tab" data-toggle="tab" class="courseRule"><?= Yii::t('common', 'complete_rule') ?></a></li>                            <?php                            }                            ?>                        </ul>                        <div class="tab-content">                            <div role="tabpanel" class="tab-pane active" id="courseIntro">                                <div class="panel-default scoreList">                                    <div class="panel-default scoreList pathBlock">                                        <div role="tab" id="headingOne">                                            <p><?=Yii::t('frontend', 'introduction_course')?>:</p>                                            <div class="course_desc">                                                <?=Html::decode($model->course_desc)?>                                            </div>                                        </div>                                        <div class="clearfix"></div>                                        <hr />                                        <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">                                            <div class="">                                                <ul class='panel-collapse collapse in' role='tabpanel' aria-labelledby='headingOne' id='collapseExample'><h4>                                                    <?=Yii::t('common', 'scorm_course_unit')?>  </h4>                                                                                                    <? foreach ($catalogMenu as $modNum => $mod) {?>                                                        <li class='pathStep'>                                                            <span class='step lessWord' style='width: 68%; margin-right: 0;'>                                                                <?=$mod['mod_name']?>                                                            </span>                                                                <? if ($mod['time'] != 0) { ?>                                                                <span class='stepTime pull-right'><?=Yii::t('frontend', 'study_hours')?>：<?=$mod['time']?><?=Yii::t('frontend', 'time_minute')?></span>                                                            <? }?>                                                                <? if (!empty($mod['mod_desc'])) { ?>                                                                <p><?=Yii::t('frontend', 'module_description')?>：<?=TStringHelper::OutPutBr($mod['mod_desc'])?></p>                                                            <? }?>                                                                <ul class='pathTask'>                                                                <?                                                                if (!empty($mod['courseitems'])) {                                                                    foreach ($mod['courseitems'] as $num => $resource) {                                                                            $displayItem = $resource['displayItem'];                                                                            if ($displayItem) {                                                                            $learnStatus = $resource['learning_status'];                                                                            if ($learnStatus == "learned") {                                                                                echo "<li class='learned'>";                                                                            } else if ($learnStatus == "learning") {                                                                                echo "<li class='learning'>";                                                                            } else {                                                                                echo "<li class=''>";                                                                            }                                                                            $canRun = $resource['canRun'];                                                                            $mode = $resource['mode'];                                                                            $itemName = $resource['itemName'];                                                                            $componentName = $resource['componentName'];                                                                            $componentCode = $resource['componentCode'];                                                                            $componentIcon = $resource['componentIcon'];                                                                            $modResId = $resource['modResId'];                                                                            if ($mode == CourseService::PLAY_MODE_NORMAL) {                                                                                if ($canRun) {                                                                                    echo "<span class='taskName'><i class='unLearn'></i>" .                                                                                        $componentIcon .                                                                                        "&nbsp;<a href='" .                                                                                        Yii::$app->urlManager->createUrl(['resource/course/play', 'modResId' => $modResId]) .                                                                                        "' title='" . Yii::t('common', 'learn_button') . "'>" .                                                                                        $itemName . "</a></span>";                                                                                }                                                                                else {                                                                                    echo "<span class='taskName'><i class='unLearn'></i>" .                                                                                        $componentIcon .                                                                                        "&nbsp;" .                                                                                        $itemName . "</span>";                                                                                }                                                                            } else {                                                                                echo "<span class='taskName'><i class='unLearn'></i>" .                                                                                    $componentIcon .                                                                                    "&nbsp;<a href='" .                                                                                    Yii::$app->urlManager->createUrl(['resource/course/play-preview', 'modResId' => $modResId]) .                                                                                    "' title='" . Yii::t('common', 'learn_button') . "'>" .                                                                                    $itemName . "</a></span>";                                                                            }                                                                                echo "<span class='taskTime pull-right'>" . $componentName . "</span>";                                                                                echo "</li>";                                                                        }                                                                    }                                                                }                                                                ?>                                                                </ul>                                                        </li>                                                    <? } ?>                                                </ul>                                            </div>                                        </div>                                    </div>                                </div>                            </div>                            <?php                            if (!empty($certificationTemplatesUrl)) {                                ?>                                <div role="tabpanel" class="tab-pane" id="profile">                                    <div class=" panel-default scoreList">                                        <div class="panel-body">                                            <h3 style="text-align:center;"><?=Yii::t('frontend', 'course_finish_get_certificate')?>.</h3>                                            <img src="<?=$certificationTemplatesUrl?>" style="margin-top:4%; width:100%; box-shadow:0 0 1px 2px #ccc;">                                        </div>                                    </div>                                </div>                            <?php                            }                            if (!empty($teacher)) {                                ?>                                <div role="tabpanel" class="tab-pane" id="messages">                                    <div class=" panel-default scoreList">                                        <div class="panel-body">                                            <hr />                                            <div class="row col-md-12">                                            <?php                                            $teacherCount = count($teacher);                                            $i = 0;                                            foreach ($teacher as $i => $vo) {                                                ?>                                                <div class="row <?=$teacherCount>1?'col-md-6':'col-md-12'?>">                                                    <div class="col-md-2">                                                        <img src="<?= TStringHelper::Thumb($vo['teacher_thumb_url'],$vo['gender']) ?>" onerror="this.src='/static/common/images/man.jpeg';" style="margin-top:20px; width:100%; text-align:center;">                                                    </div>                                                    <div class="col-md-10">                                                        <h3 style="text-align:left;"><?= $vo['teacher_name'] ?></h3>                                                        <p>                                                            <?php                                                            if (!empty($vo['description'])){                                                                echo $vo['description'];                                                            }else{                                                            ?>                                                                <?=Yii::t('frontend', 'no_teacher_detail')?>                                                                <?php                                                            }                                                            ?>                                                        </p>                                                    </div>                                                </div>                                            <?php                                                if ($i%2==1){                                            ?>                                                </div><div class="row col-md-12">                                            <?php                                                }                                            }                                            ?>                                            </div>                                        </div>                                    </div>                                </div>                            <?php                            }                            ?>                            <div role="tabpanel" class="tab-pane" id="question">                                <div class=" panel-default scoreList">                                    <div class="panel-body" id="question-answer"></div>                                </div>                            </div>                            <div role="tabpanel" class="tab-pane" id="courseRule">                                <div class=" panel-default scoreList">                                    <div class="panel-body"id="course-rule">                                        <div class="panel-list" id="config_list" data-url="<?=Url::toRoute(['/resource/course/get-course-config','id'=>$model->kid])?>"></div>                                        <div id="list_loading" class="loadingWaiting hide" style="margin:100px auto;">                                            <span></span>                                            <span></span>                                            <span></span>                                            <span></span>                                            <span></span>                                            <p><?=Yii::t('frontend', 'loading')?>...</p>                                        </div>                                    </div>                                </div>                            </div>                        </div>                    </div>                </div>            </div>        </div>    </div></div><?//= Html::jsFile('/static/frontend/js/rating.js')?><script>    var questionTabUrl = '<?=Url::toRoute(['resource/course/get-tab-question','courseId'=>$model->kid])?>';    var courseRuleUrl = "<?=Url::toRoute(['/resource/course/get-course-config','id'=>$model->kid])?>";    var peopleQueryList;    app.extend('alert');    function FmodalLoad(target, url)    {        if(url){            $('#'+target).empty();            var loadingDiv = '<div class="load-wrapp"><div class="load-9"><div class="spinner"><div class="bubble-1"></div><div class="bubble-2"></div></div><p><?= Yii::t('frontend', 'loading') ?>...</p></div></div>';            $('#'+target).html(loadingDiv); // 设置页面加载时的loading图片            app.get(url,function(r){                if (r){                    $('#'+target).html(r);                }            });        }    }    $(function(){        peopleQueryList = app.queryList("#search_people");        $(".getQuestion").click(function(e){            e.preventDefault();            FmodalLoad('question-answer', questionTabUrl);        });        $(".courseRule").click(function(e){            e.preventDefault();            FmodalLoad('course-rule', courseRuleUrl);        });        <? if ( $canRating ) :?>        $("#rating").bind('click',function(){            var rating=app.getRating("pingfen");            $.post(                '<?=Yii::$app->urlManager->createUrl(['resource/course/rating'])?>',                {'course_id': '<?=$model->kid?>', 'rating': rating}            ).done(function(data) {                    var result = data.result;                    if (result === 'other'){                        app.showMsg(data.message);                    }else if (result === 'failure') {                        app.showMsg('failure');                    }else {                        if (checkPointResult(data.pointResult)){                                //score-Effect(data.point);                                scorePointEffect(data.pointResult.show_point, data.pointResult.point_name, data.pointResult.available_point);                        }                        app.showMsg('<?=Yii::t('common', 'operation_success')?>');                        $("#rating").attr('data-rating',Math.round(data.message.avg));                        $("#rating").attr('data-person',data.message.count);                        $("#rating").attr('title',data.message.avg+'<?=Yii::t('frontend', 'point')?>');                        app.genRating("pingfen");                        $("#rating").unbind();                        $("#rating").addClass('disabled');                    }                }).fail(function() {                    app.showMsg("<?=Yii::t('frontend', 'operation_confirm_warning_internal_error')?>");                });        });        <? else:?>        $(".ui.star.rating").each(app.genRating).rating('disable');        <? endif;?>        $("#newShareBtn").click(function(e){            app.alertSmall("#newShare");        });        $("#newTaskBtn").click(function(e){            $('#studentList').empty();            app.get(studentUrl,function(r){                if (typeof r.result != 'undefined' && r.result == 'fail'){                    $("#studentList").html("");                    app.showMsg('<?=Yii::t('frontend', 'no_students_can_be_assigned')?>');                    return false;                }else{                    $("#studentList").html(r);                    app.alertSmall("#newTask");                }            });        });    });    function RegisterCourse(id)    {        var ajaxUrl = "<?=Yii::$app->urlManager->createUrl(['resource/course/reg','id'=>$model->kid])?>";        ajaxUrl = urlreplace(ajaxUrl, 'id', id);        RegisterAction(ajaxUrl);    }    function EnrollCourse()    {        app.alert("#signUpResult");    }    function RegisterAction(ajaxUrl)    {        ajaxData(ajaxUrl,            "POST",            {},            "json",            function (data) {                var result = data.result;                if (result == "success")                {                    if (checkPointResult(data.pointResult)){                            //score-Effect(data.score);                            scorePointEffect(data.pointResult.show_point, data.pointResult.point_name, data.pointResult.available_point);                                    }                    setTimeout(function(){                        var newurl = "<?=Yii::$app->urlManager->createUrl(['resource/course/view','id'=>$model->kid])?>";                        window.location.href = newurl;                    },1000);                }                else                {                    var message = data.message;                    app.showMsg(message);                }            }        );    }    function GiveupRestartConfirm(id)    {        var msg = "<?=Yii::t('frontend', 'give_up_and_get_last_record')?>？";        var ajaxUrl = "<?=Yii::$app->urlManager->createUrl(['resource/course/giveup-restart-course'])?>";        ajaxUrl = urlreplace(ajaxUrl, 'id', id);        NotyConfirm(msg,  function(e){            RestartAction(ajaxUrl);        });    }    function RestartConfirm(id)    {        var msg = "<?=Yii::t('frontend', 'give_up_and_restet_record')?>？";        var ajaxUrl = "<?=Yii::$app->urlManager->createUrl(['resource/course/restart-course'])?>";        ajaxUrl = urlreplace(ajaxUrl, 'id', id);        NotyConfirm(msg,  function(e){            RestartAction(ajaxUrl);        });    }    function RestartAction(ajaxUrl)    {        ajaxData(ajaxUrl,            "POST",            {},            "json",            function (data) {                var result = data.result;                if (result == "success")                {                    //alert(result);                    var newurl = "<?=Yii::$app->urlManager->createUrl(['resource/course/view','id'=>$model->kid])?>";                    window.location.href = newurl;                }                else                {                    var message = data.message;                    app.showMsg(message);                }            }        );    }    function share(){        var actionUrl = '<?=Yii::$app->urlManager->createUrl(['resource/course/share'])?>';        var obj_id = $("#shareModal #obj_id").val();        if($("#shareModal #title").val() == ''){            $("#shareModal #title").focus();            return;        }        var title = $("#shareModal #title").val();        var content = $("#shareModal #content").attr('data-title');        var users = peopleQueryList.get();        var data = {'obj_id': obj_id, 'title': title, 'content': content, 'users': users};        $.post(            actionUrl,            data        ).done(function(data) {                var result = data.result;                if (result === 'other'){                    app.showMsg(data.message);                }else if (result === 'failure') {                    app.showMsg('<?=Yii::t('common', 'operation_confirm_warning_failure')?>');                }else{                    app.hideAlert("#newShare");                    app.showMsg('<?=Yii::t('common', 'operation_success')?>');                }            }).fail(function() {                app.showMsg("<?=Yii::t('common', 'operation_confirm_warning_internal_error')?>");            });        return true;    }    function ToggleCollection(obj_id,obj){        var actionUrl = '<?=Yii::$app->urlManager->createUrl(['resource/course/collection'])?>';        $.post(            actionUrl,            'obj_id='+obj_id        ).done(function(data) {                var result = data.result;                if (result === 'other'){                    app.showMsg(data.message);                }else if (result === 'failure') {                    app.showMsg('<?=Yii::t('common', 'operation_confirm_warning_failure')?>');                    //app.alert("#newFollow");                    //$("#newFollow .body").html('<div style="text-align: center;padding: 20px;"><?=Yii::t('common', 'operation_confirm_warning_failure')?></div>');                }else{                    if($(obj).text() == '<?=Yii::t('common','collection')?>'){                        $(obj).text('<?=Yii::t('common','canel_collection')?>');                        if (checkPointResult(data.pointResult)){                            //score-Effect(data.point);                            scorePointEffect(data.pointResult.show_point,data.pointResult.point_name,data.pointResult.available_point);                        }                        else {                            app.showMsg("<?=Yii::t('frontend', 'collection_sucess')?>");                        }                        //app.alert("#newFollow");                        //$("#newFollow .body").html('<div style="text-align: center;padding: 20px;">收藏成功</div>');                    }else{                        $(obj).text('<?=Yii::t('common','collection')?>');                        app.showMsg('<?=Yii::t('common', 'operation_success')?>');                        //app.alert("#newFollow");                        //$("#newFollow .body").html('<div style="text-align: center;padding: 20px;">取消成功</div>');                    }                }            }).fail(function() {                app.showMsg("<?=Yii::t('common', 'operation_confirm_warning_internal_error')?>");            });    }</script><!-- 分享的弹出窗口 --><div class="ui modal" id="newShare">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?=Yii::t('frontend', 'share_to_social_circle')?></h4>    </div>    <div class="body" id="shareModal" style="padding: 10px;">        <div class="row" style="padding: 10px;">            <input type="hidden" id="obj_id" name="obj_id" value="<?=$model->kid?>">            <textarea class="form-control" id="title" style="width:100%; height: 100px; border:1px solid #eee;" value="" placeholder=" <?=Yii::t('frontend', 'say_something')?>"></textarea>            <div id="content" style="width:100%;padding: 10px 0" data-title="<?=Html::encode($model->course_name)?>">                <?=Yii::t('common', 'course_name')?>: 《<?=Html::encode($model->course_name)?>》            </div>            <br/>            <table class="tiwen">                <tr>                    <td class="mouren" style="text-align:center">@<?=Yii::t('frontend', 'some_one')?></td>                    <td class="tdwrapper" style="width:160px">                        <input id="search_people" style="height:30px" type="text" data-url="<?=Yii::$app->urlManager->createUrl('common/search-people')?>?format=new" data-mult="1" />                    </td>                    <td style="width:180px">                        <a href="javascript:;" onclick="share()" class="btn btn-success btn-sm pull-right"><?=Yii::t('frontend', 'share')?></a>                    </td>                </tr>            </table>        </div>    </div>    <div class="c"></div></div><!-- 收藏的弹出窗口 --><div class="ui modal" id="newFollow">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?=Yii::t('frontend', 'prompt')?></h4>    </div>    <div class="body"></div>    <div class="c"></div></div><?if ($isManager && $isOnlineCourse): ?><!-- 新任务的弹出窗口 --><div class="ui modal" id="newTask">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?=Yii::t('common', 'assign')?></h4>    </div>    <div class="body">        <div class="col-md-12 col-sm-12 myGroupList_mini">            <?php $form = ActiveForm::begin([                'id' => 'pushForm',                'method' => 'post',                'action' => Url::toRoute(['/resource/course/panel-task-push','id'=>$model->kid])            ]); ?>            <div class="row">                <input type="text" class="search_real_name" placeholder="<?=Yii::t('frontend', 'input_{value}',['value'=>Yii::t('common','real_name').Yii::t('common','art_keywords')])?>" style="width:100%; height:30px;border:1px solid #eee;">            </div>            <div class="myGroupList_mini" id="studentList" style="height: 400px; "></div>            <div class="row">                <input type="text" name="plan_com_at" id="plan_com_at" placeholder="<?=Yii::t('frontend', 'input_{value}',['value'=>Yii::t('common','end_time2')])?>" style="width:100%; height:30px;border:1px solid #ccc;" data-type="rili"  data-full="1" readonly>            </div>            <div class="centerBtnArea" style="margin-bottom: 15px;">                <?=Html::button(Yii::t('frontend', 'course_assign'),['id' => 'courseTaskButton', 'class' => 'btn btn-sm btn-success centerBtn', 'onclick'=>'submitPushForm()'])?>            </div>            <?php ActiveForm::end(); ?>        </div>    </div>    <div class="c"></div></div><script>    var studentUrl = '<?=Url::toRoute([$this->context->id.'/get-student-user','id'=>$model->kid])?>';    $(function(){       $(".search_real_name").keyup(function(){           var keyword = $(this).val().replace(/\s+/g,'');           $.get(studentUrl,{keyword: keyword}, function(data){               if (typeof data.result != 'undefined' && data.result == 'fail'){                   $("#studentList").html("<p style='margin: 30px 0;'><?=Yii::t('common', 'no_data')?></p>");               }else{                   $("#studentList").html(data);               }           });       }) ;    });    function submitPushForm()    {        var selectUserCount=$("input:checkbox[name='users[]']:checked").length;        if(selectUserCount == 0)        {            app.showMsg('<?=Yii::t('common', 'select_{value}',['value'=>Yii::t('frontend','student')])?>');            return false;        }        if ($("#plan_com_at").val() == ""){            app.showMsg('<?=Yii::t('frontend', 'input_{value}',['value'=>Yii::t('common','end_time2')])?>');            return false;        }        var $form = $('#pushForm');        var actionUrl = $form.attr("action");        $.post(            actionUrl,            $form.serialize()        ).done(function(data) {                var result = data.result;                if (result === 'other'){                    app.showMsg(data.message);                }                else if (result === 'failure') {                    app.showMsg('<?=Yii::t('common', 'operation_confirm_warning_failure')?>.');                }                else                {                    app.showMsg('<?=Yii::t('common', 'operation_success')?>');                    $form[0].reset();                    app.hideAlert($("#newTask"));                }            }).fail(function() {                app.showMsg("<?=Yii::t('common', 'operation_confirm_warning_internal_error')?>");            });        return false;    }</script><?phpendif;if ($model->course_type == LnCourse::COURSE_TYPE_FACETOFACE) {?><!-- 报名的弹出窗口 --><div class="ui modal" id="signUpResult">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?= Html::encode($model->course_name) ?></h4>    </div>    <div class="content centerBtnArea">        <br />        <p><?=Yii::t('frontend', 'enroll_time')?>: <?= date('Y年m月d日', $model->enroll_start_time) ?>~<?= date('m月d日', $model->enroll_end_time) ?></p>        <?php        if ($model->limit_number > $enrollRegNumber) {        ?>        <h4><?=Yii::t('frontend', 'surplus_spots')?>: <strong id="last_number"><?= ($model->limit_number - $enrollRegNumber) ?></strong>人</h4>        <br />        <div class="centerBtnArea">            <a href="javascript:;" class="btn btn-success btn-sm centerBtn additionBtn" id="signUpResultBtn"><?=Yii::t('frontend', 'i_want_enroll')?></a>        </div>        <?php        } else {            if ($model->is_allow_over == LnCourse::IS_ALLOW_OVER_YES) {                if (($model->allow_over_number - $enrollAlternatenNumber) < 1) {        ?>        <h4><?=Yii::t('frontend', 'spots_is_full_care_msg')?>。</h4>        <br />        <div class="centerBtnArea">            <a href="###" class="btn btn-success btn-sm centerBtn additionBtn" onclick="app.hideAlert('#signUpResult');return false;"><?=Yii::t('common', 'back_button')?></a>        </div>        <?php                }else {        ?>        <h4><?=Yii::t('frontend', 'spots_is_full_add_waiting')?>。</h4>        <br />        <div class="centerBtnArea">            <a href="javascript;" class="btn btn-success btn-sm centerBtn additionBtn" id="signUpResultBtn"><?=Yii::t('frontend', 'add_waiting')?></a>        </div>        <?php                }            }else{        ?>        <h4><?=Yii::t('frontend', 'spots_is_full_care_msg')?>。</h4>        <br />        <div class="centerBtnArea">            <a href="###" class="btn btn-success btn-sm centerBtn additionBtn" onclick="app.hideAlert('#signUpResult');return false;"><?=Yii::t('common', 'back_button')?></a>        </div>        <?php            }        }        ?>    </div>    <div class="c"></div></div><?php}?><!-- 二维码的弹出窗口 --><div class="ui modal" id="bigCode"  >    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?=Yii::t('frontend', 'qr_code')?></h4>    </div>    <div class="content">        <div class="panel-body">            <img src="<?=TStringHelper::genQRCode($model->short_code)?>" style="width:100%; height:auto;text-align: center;">        </div>        <div class="c"></div>    </div></div><script>    function bigcode(){        app.alert('#bigCode');    };</script><!-- 报名提醒的弹出窗口 --><div class="ui modal" id="signUpResult_note">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title" id="myModalLabel"><?=Html::encode($model->course_name)?></h4>    </div>    <div class="body centerBtnArea">        <h4><?=Yii::t('frontend', 'enroll_is_set_waiting')?></h4>        <div class="centerBtnArea">            <a href="<?=Url::toRoute(['resource/course/index'])?>" class="btn btn-success btn-sm centerBtn additionBtn"><?=Yii::t('common', 'back_button')?><?=Yii::t('common', '{value}_list',['value'=>Yii::t('common','course')])?></a>        </div>    </div>    <div class="c"></div></div><script>    var enroll_url = "<?=Url::toRoute(['/resource/course/get-enroll-count','id'=>$model->kid])?>";    $(function(){        $("#signUpResultBtn").click(function(e){            e.preventDefault();            app.get(enroll_url, function(r){                if (r.result == 'success'){                    app.hideAlert("#signUpResult");                    app.alert('#signUpResult_note');                }else{                    app.showMsg(r.errmsg);                }            },'json');        });        $("#signUpResult_note button.close").click(function(){           location.reload();        });    });</script><?phpif (!$isOnlineCourse && $openStatus == LnCourse::STATUS_FLAG_NORMAL && !empty($enrollInfo) && $enrollInfo->enroll_type == LnCourseEnroll::ENROLL_TYPE_ALLOW):?><!-- 签到记录 --><div class="ui modal" id="allSignInDialog">    <div class="header">        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>        <h4 class="modal-title"><?=Yii::t('frontend', 'signin_all_data')?></h4>    </div>    <div class="content">        <div id="signlist"></div>        <div class="c"></div>    </div></div><script>    var signin_title = '<?=$signStatusData['sign_title']?>';    $('.signInBtn').bind('click',function(){        if ($(this).hasClass('btn-default')){            app.showMsg('<?=Yii::t('frontend', 'signin_is_not_repeat')?>');        }else {            $.get("<?=Url::toRoute(['/resource/course/signin', 'id' => $model->kid])?>", function (html) {                if (html.result == 'success') {                    $(".signInBtn").removeClass('btn-success').addClass('btn-default').text(signin_title+'<?=Yii::t('frontend', 'signin_has_data')?>').unbind('click');                } else {                    app.showMsg('<?=Yii::t('common', 'operation_confirm_warning_failure')?>');                    return false;                }            }, 'json');        }    });    $("#allSignIn").on('click', function(){        $("#signlist").empty();        $.get("<?=Url::toRoute(['/resource/course/get-signin-record','id' => $model->kid])?>", function(r){            if (r){                $("#signlist").html(r);                app.alertWide($("#allSignInDialog"));            }        });    });    $("#signlist").on('change', '#course_sign', function(){        var date = $(this).val();        $("#signlist").empty();        $.get("<?=Url::toRoute(['/resource/course/get-signin-record','id' => $model->kid])?>", {date: date}, function(r){            if (r){                $("#signlist").html(r);            }        });    });</script><?phpendif;?>